<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>NEON // SPEEDREADER // VILE</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --cyber-blue: #00f3ff;
      --cyber-green: #0aff0a;
      --vile-red: #ff003c;
      --vile-dark: #3a000e;
      --bg-color: #030303;
      --glass: rgba(10, 10, 10, 0.9);
      --cell-size: min(11vw, 55px);
    }

    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0;
      height: 100vh;
      background-color: var(--bg-color);
      font-family: 'JetBrains Mono', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      color: var(--cyber-blue);
    }

    /* Scanlines */
    body::after {
      content: "";
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15) 0px, rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);
      pointer-events: none;
      z-index: 100;
    }

    /* Glitch effect for text */
    .glitch { position: relative; }
    .glitch::before, .glitch::after {
      content: attr(data-text);
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
    }
    .glitch::before {
      left: 2px; text-shadow: -2px 0 var(--vile-red);
      clip: rect(24px, 550px, 90px, 0);
      animation: glitch-anim 5s infinite linear alternate-reverse;
    }
    .glitch::after {
      left: -2px; text-shadow: -2px 0 var(--cyber-blue);
      clip: rect(85px, 550px, 140px, 0);
      animation: glitch-anim2 5s infinite linear alternate-reverse;
    }

    @keyframes glitch-anim {
      0% { clip: rect(42px, 9999px, 44px, 0); }
      5% { clip: rect(12px, 9999px, 59px, 0); }
      100% { clip: rect(4px, 9999px, 91px, 0); }
    }
    @keyframes glitch-anim2 {
      0% { clip: rect(65px, 9999px, 100px, 0); }
      100% { clip: rect(31px, 9999px, 57px, 0); }
    }

    /* --- LOADING SCREEN --- */
    #loading-screen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #000; z-index: 200;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      transition: opacity 0.8s ease-out;
    }
    #loading-icon {
      font-size: 5rem; color: var(--vile-red);
      text-shadow: 0 0 20px var(--vile-red); margin-bottom: 20px;
      animation: pulse 1.5s infinite alternate;
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.7; }
      100% { transform: scale(1.1); opacity: 1; text-shadow: 0 0 30px var(--vile-red); }
    }
    .loading-text { font-family: 'Orbitron'; letter-spacing: 4px; font-size: 0.8rem; color: #555; margin-top: 20px; }
    .loading-progress { width: 300px; height: 4px; background: rgba(255,255,255,0.1); margin-top: 30px; border-radius: 2px; overflow: hidden; }
    .loading-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--vile-red), var(--cyber-blue)); transition: width 0.3s ease; }

    /* --- MENUS --- */
    #menu-screen {
      position: absolute; top:0; left:0; width:100%; height:100%;
      background: rgba(3,3,3,0.95); z-index: 50;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      padding: 20px;
    }
    .menu-title { font-family: 'Orbitron'; font-size: 2.8rem; text-align: center; margin-bottom: 30px; text-shadow: 0 0 10px var(--cyber-blue); line-height: 1.2; }
    .vile-text { color: var(--vile-red); text-shadow: 0 0 15px var(--vile-red); }
    .menu-subtitle { font-family: 'JetBrains Mono'; font-size: 0.9rem; color: #888; text-align: center; max-width: 500px; margin-bottom: 40px; line-height: 1.5; }

    .menu-btn {
      background: transparent; border: 1px solid var(--cyber-blue); color: var(--cyber-blue);
      padding: 16px 30px; margin: 10px; font-family: 'Orbitron'; font-size: 1.1rem;
      cursor: pointer; width: 280px; text-transform: uppercase; transition: 0.2s;
      letter-spacing: 1px; position: relative; overflow: hidden;
    }
    .menu-btn:hover { background: var(--cyber-blue); color: #000; box-shadow: 0 0 20px var(--cyber-blue); transform: translateY(-3px); }
    .menu-btn.secondary { border-color: var(--vile-red); color: var(--vile-red); }
    .menu-btn.secondary:hover { background: var(--vile-red); color: #000; box-shadow: 0 0 20px var(--vile-red); }

    .diff-selector { display: flex; gap: 10px; margin-top: 10px; margin-bottom: 30px; flex-wrap: wrap; justify-content: center; }
    .diff-btn {
      border: 1px solid #333; color: #666; background: transparent; padding: 10px 16px;
      font-family: 'JetBrains Mono'; cursor: pointer; font-size: 0.9rem; min-width: 100px; transition: all 0.2s;
    }
    .diff-btn.selected {
      border-color: var(--vile-red); color: var(--vile-red);
      box-shadow: inset 0 0 10px rgba(255,0,60,0.3); background: rgba(255,0,60,0.05);
    }
    .speed-label { font-family: 'Orbitron'; font-size: 0.8rem; color: #888; margin-top: 5px; }

    /* --- GAME UI --- */
    #game-area {
      display: flex; flex-direction: column; align-items: center;
      width: 100%; height: 100vh; padding: 20px; position: relative; z-index: 10;
    }
    .hud {
      width: 100%; max-width: 800px; display: flex; justify-content: space-between;
      padding: 15px; font-family: 'Orbitron'; border-bottom: 1px solid rgba(0, 243, 255, 0.2);
      margin-bottom: 10px; background: rgba(0,0,0,0.5);
    }
    .hud-box { padding: 5px 10px; text-align: center; }
    .stat-value { font-size: 1.5rem; font-weight: bold; color: var(--cyber-blue); text-shadow: 0 0 5px var(--cyber-blue); }
    .stat-label { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 2px;}

    /* UPDATED LAYOUT FOR WORD DISPLAY */
    .word-display-container {
      width: 100%; max-width: 800px; height: 350px;
      display: flex; justify-content: center; align-items: center;
      margin: 20px 0; position: relative;
    }
    
    .word-display {
      width: 100%; height: 100%;
      background: rgba(5, 5, 10, 0.7);
      border: 1px solid rgba(0, 243, 255, 0.1);
      border-left: 4px solid var(--cyber-blue);
      border-right: 4px solid var(--cyber-blue);
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      box-shadow: 0 0 30px rgba(0,0,0,0.8);
      position: relative; overflow: hidden;
    }

    /* Focus Guides (Reticle) */
    .focus-guide {
      position: absolute; width: 20px; height: 2px;
      background: var(--vile-red); left: 50%; transform: translateX(-50%);
      opacity: 0.5;
    }
    .focus-guide.top { top: 35%; }
    .focus-guide.bottom { bottom: 35%; }

    #current-word {
      font-size: 4rem; font-weight: 800; color: #fff;
      text-align: center; text-shadow: 0 0 15px var(--cyber-blue);
      font-family: 'Orbitron', sans-serif;
      z-index: 2; padding: 0 20px;
    }

    /* Ghost Text (Next word preview) */
    #next-word-ghost {
      font-size: 1.5rem; color: rgba(255,255,255,0.15);
      margin-top: 20px; font-family: 'JetBrains Mono';
      text-transform: lowercase; letter-spacing: 2px;
    }

    .speed-level {
      position: absolute; top: 20px; right: 20px;
      font-family: 'Orbitron'; font-size: 0.8rem; color: var(--vile-red);
      border: 1px solid var(--vile-red); padding: 4px 10px;
    }

    /* Controls */
    .controls { display: flex; gap: 20px; margin-top: 10px; flex-wrap: wrap; justify-content: center; width: 100%; max-width: 800px; }
    .control-btn {
      background: transparent; border: 1px solid var(--cyber-blue); color: var(--cyber-blue);
      padding: 14px 28px; font-family: 'Orbitron'; font-size: 1rem;
      cursor: pointer; min-width: 160px; text-transform: uppercase; transition: 0.2s;
    }
    .control-btn:hover { background: var(--cyber-blue); color: #000; box-shadow: 0 0 15px var(--cyber-blue); }
    .control-btn.red { border-color: var(--vile-red); color: var(--vile-red); }
    .control-btn.red:hover { background: var(--vile-red); color: #000; box-shadow: 0 0 15px var(--vile-red); }

    /* Progress Bar */
    .progress-container { width: 100%; max-width: 800px; margin-top: 30px; }
    .progress-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-family: 'Orbitron'; font-size: 0.9rem; color: #888; }
    .progress-bar { height: 6px; background-color: rgba(255, 255, 255, 0.1); border-radius: 3px; overflow: hidden; }
    .progress-fill { height: 100%; background: var(--vile-red); width: 0%; transition: width 0.2s linear; }

    /* MODAL */
    #modal-overlay {
      position: absolute; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.95); z-index: 60;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
    }
    #modal-msg { font-family: 'Orbitron'; font-size: 2.8rem; color: #fff; margin-bottom: 30px; text-align: center; }
    .modal-stats { display: flex; gap: 30px; margin-bottom: 40px; }
    .modal-stat { text-align: center; }
    .modal-stat-value { font-size: 2.5rem; color: var(--cyber-blue); font-family: 'Orbitron'; }
    .modal-stat-label { font-size: 0.9rem; color: #888; margin-top: 5px; }

    .hidden { display: none !important; }
    .blink { animation: blink 1s infinite alternate; }
    @keyframes blink { 0% { opacity: 1; } 100% { opacity: 0.5; } }

    @media (max-width: 768px) {
      .menu-title { font-size: 2rem; }
      #current-word { font-size: 2.5rem; }
      .controls { flex-direction: column; align-items: center; }
      .control-btn { width: 90%; }
      .modal-stats { flex-direction: column; gap: 15px; }
    }
  </style>
</head>
<body>

  <div id="loading-screen">
    <div id="loading-icon">⚡</div>
    <div class="loading-text">INITIALIZING NEURAL ACCELERATOR...</div>
    <div class="loading-progress">
      <div class="loading-bar" id="loading-bar"></div>
    </div>
  </div>

  <div id="menu-screen" class="hidden">
    <div class="menu-title">NEON <span class="vile-text">SPEEDREADER</span></div>
    <div class="menu-subtitle">System ready. Injecting data stream. Words are no longer scattered; they form the narrative of the new world.</div>
    
    <div class="diff-selector">
      <button class="diff-btn" onclick="setSpeed('slow')" id="btn-slow">
        <div>SCANNER</div>
        <div class="speed-label">200 WPM</div>
      </button>
      <button class="diff-btn selected" onclick="setSpeed('normal')" id="btn-normal">
        <div>PROCESSOR</div>
        <div class="speed-label">300 WPM</div>
      </button>
      <button class="diff-btn" onclick="setSpeed('fast')" id="btn-fast">
        <div>ACCELERATOR</div>
        <div class="speed-label">400 WPM</div>
      </button>
      <button class="diff-btn" onclick="setSpeed('extreme')" id="btn-extreme">
        <div>CYBERNETIC</div>
        <div class="speed-label">500 WPM</div>
      </button>
    </div>
    
    <button class="menu-btn" onclick="startTraining()">INITIATE SEQUENCE</button>
    <button class="menu-btn secondary" onclick="showInstructions()">PROTOCOLS</button>
  </div>

  <div id="game-area" class="hidden">
    <div class="hud">
      <div class="hud-box">
        <div class="stat-label">SPEED (WPM)</div>
        <div class="stat-value" id="wpm">0</div>
      </div>
      <div class="hud-box">
        <div class="stat-label">WORDS READ</div>
        <div class="stat-value" id="word-count">0</div>
      </div>
      <div class="hud-box">
        <div class="stat-label">TIME</div>
        <div class="stat-value" id="time-left">60</div>
      </div>
    </div>
    
    <div class="word-display-container">
      <div class="word-display">
        <div class="focus-guide top"></div>
        <div class="focus-guide bottom"></div>
        
        <div id="current-word">READY</div>
        <div id="next-word-ghost">...</div> <div class="speed-level" id="speed-level">SCANNER</div>
      </div>
    </div>
    
    <div class="controls">
      <button class="control-btn" id="start-btn" onclick="toggleTraining()">
        <span id="start-text">ACTIVATE</span>
      </button>
      <button class="control-btn red" id="reset-btn" onclick="resetTraining()">RESET</button>
      <button class="control-btn" onclick="toMenu()">ABORT</button>
    </div>
    
    <div class="progress-container">
      <div class="progress-header">
        <div>DATA STREAM PROGRESS</div>
        <div id="progress-text">0%</div>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
    </div>
  </div>

  <div id="modal-overlay" class="hidden">
    <div id="modal-msg">TRAINING COMPLETE</div>
    <div class="modal-stats">
      <div class="modal-stat">
        <div class="modal-stat-value" id="final-wpm">0</div>
        <div class="modal-stat-label">AVG WPM</div>
      </div>
      <div class="modal-stat">
        <div class="modal-stat-value" id="final-words">0</div>
        <div class="modal-stat-label">TOTAL WORDS</div>
      </div>
      <div class="modal-stat">
        <div class="modal-stat-value" id="final-level">SCANNER</div>
        <div class="modal-stat-label">PEAK LEVEL</div>
      </div>
    </div>
    <button class="menu-btn" onclick="toMenu()">RETURN TO BASE</button>
    <button class="menu-btn secondary" onclick="restartTraining()">REINITIALIZE</button>
  </div>

<script>
/**
 * NEON SPEEDREADER PRO - CYBERNETIC EDITION v2
 */

// --- CONFIG ---
const SPEED_LEVELS = {
  'slow': { wpm: 200, label: 'SCANNER' },
  'normal': { wpm: 300, label: 'PROCESSOR' },
  'fast': { wpm: 400, label: 'ACCELERATOR' },
  'extreme': { wpm: 500, label: 'CYBERNETIC' }
};

// ACTUAL STORY DATA (Replacing scattered words)
const STORY_TEXT = `
The sky above the port was the color of television, tuned to a dead channel. 
It was not like I was using, Case heard someone say, as he shouldered his way through the crowd around the door of the Chat. 
It is like my body has developed this massive drug deficiency. It was a Sprawl voice and a Sprawl joke. 
The Chatsubo was a bar for professional expatriates; you could drink there for a week and never hear two words in Japanese. 
Case was twenty-four. At twenty-two, he had been a cowboy, a rustler, one of the best in the Sprawl. 
He had been trained by the best, by McCoy Pauley and Bobby Quine, legends in the biz. 
He operated on an almost permanent adrenaline high, a byproduct of youth and proficiency, plugged into a custom cyberspace deck that projected his disembodied consciousness into the consensual hallucination that was the matrix. 
A thief, he worked for other, wealthier thieves, employers who provided the exotic software required to penetrate the bright walls of corporate systems and open windows into rich fields of data. 
He had made the classic mistake, the one he had sworn he would never make. He stole from his employers. 
He kept something for himself and tried to move it through a fence in Amsterdam. 
He still was not sure how he had been discovered, not that it mattered now. 
He had expected to die, but they only smiled. Of course he was welcome, they told him, welcome to the money. 
And he was going to need it. Because - still smiling - they injected him with a Russian mycotoxin.
The damage was minute, subtle, and utterly effective.
For Case, who lived for the bodiless exultation of cyberspace, it was the Fall. 
In the bars he frequented as a cowboy hotshot, the elite stance involved a certain relaxed contempt for the flesh. 
The body was meat. Case fell into the prison of his own flesh.
`;

// --- STATE ---
const State = {
  speed: 'normal',
  targetWPM: 300,
  currentDelay: 200, // Dynamic delay in ms
  words: [],
  currentWordIndex: 0,
  isTraining: false,
  isPaused: false,
  timeLeft: 60,
  wordCount: 0,
  sessionWPM: 0,
  maxLevel: 'SCANNER',
  timer: null,
  wordTimer: null
};

const UI = {
  loader: document.getElementById('loading-screen'),
  loadIcon: document.getElementById('loading-icon'),
  loadBar: document.getElementById('loading-bar'),
  menu: document.getElementById('menu-screen'),
  game: document.getElementById('game-area'),
  currentWord: document.getElementById('current-word'),
  nextGhost: document.getElementById('next-word-ghost'),
  wpm: document.getElementById('wpm'),
  wordCount: document.getElementById('word-count'),
  timeLeft: document.getElementById('time-left'),
  speedLevel: document.getElementById('speed-level'),
  progressFill: document.getElementById('progress-fill'),
  progressText: document.getElementById('progress-text'),
  modal: document.getElementById('modal-overlay'),
  modalMsg: document.getElementById('modal-msg'),
  startBtn: document.getElementById('start-btn'),
  startText: document.getElementById('start-text'),
  finalWPM: document.getElementById('final-wpm'),
  finalWords: document.getElementById('final-words'),
  finalLevel: document.getElementById('final-level')
};

// --- LOADING SEQUENCE (Unchanged) ---
const loadIcons = ['⚡', '▚', '⟁', '⧖', '⏣'];
let loadIdx = 0;
let loadProgress = 0;
let loadInterval = setInterval(() => {
  UI.loadIcon.innerText = loadIcons[loadIdx];
  loadIdx = (loadIdx + 1) % loadIcons.length;
  if (loadProgress < 100) {
    loadProgress += Math.random() * 15;
    if (loadProgress > 100) loadProgress = 100;
    UI.loadBar.style.width = `${loadProgress}%`;
  }
}, 300);

window.onload = () => {
  setTimeout(() => {
    clearInterval(loadInterval);
    UI.loader.style.opacity = '0';
    setTimeout(() => {
      UI.loader.classList.add('hidden');
      UI.menu.classList.remove('hidden');
      parseStory();
    }, 800);
  }, 2500); 
};

// --- LOGIC ---
function parseStory() {
  // Clean text and split into array, preserving natural flow
  // We remove newlines to make it one continuous stream
  const cleanText = STORY_TEXT.replace(/\n/g, " ").trim();
  State.words = cleanText.split(/\s+/);
}

function setSpeed(speed) {
  State.speed = speed;
  State.targetWPM = SPEED_LEVELS[speed].wpm;
  document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('selected'));
  document.getElementById(`btn-${speed}`).classList.add('selected');
}

function showInstructions() {
  UI.modalMsg.innerHTML = "SYSTEM PROTOCOLS<br><br>" +
    "<span style='font-size:1rem'>1. FOCUS ON THE RED MARKERS<br>" +
    "2. DO NOT SUBVOCALIZE (SAY WORDS IN HEAD)<br>" +
    "3. SYSTEM WILL AUTO-PAUSE ON PUNCTUATION<br>" +
    "4. SPEED IS DYNAMIC BASED ON WORD LENGTH</span>";
  UI.modal.classList.remove('hidden');
  document.querySelector('.modal-stats').style.display = 'none';
}

function startTraining() {
  State.isTraining = false;
  State.isPaused = false;
  State.timeLeft = 60;
  State.wordCount = 0;
  State.sessionWPM = 0;
  State.currentWordIndex = 0;
  State.maxLevel = SPEED_LEVELS[State.speed].label;
  
  UI.currentWord.textContent = "READY";
  UI.nextGhost.textContent = "...";
  UI.wpm.textContent = State.targetWPM;
  UI.wordCount.textContent = "0";
  UI.timeLeft.textContent = "60";
  UI.speedLevel.textContent = State.maxLevel;
  UI.progressFill.style.width = "0%";
  UI.progressText.textContent = "0%";
  UI.startText.textContent = "ACTIVATE";
  
  clearInterval(State.timer);
  clearTimeout(State.wordTimer);
  
  UI.menu.classList.add('hidden');
  UI.modal.classList.add('hidden');
  UI.game.classList.remove('hidden');
}

function toggleTraining() {
  if (!State.isTraining) {
    State.isTraining = true;
    State.isPaused = false;
    UI.startText.textContent = "PAUSE";
    UI.currentWord.classList.remove('blink');
    State.timer = setInterval(updateCountdown, 1000);
    displayNextWord();
  } else if (State.isTraining && !State.isPaused) {
    State.isPaused = true;
    UI.startText.textContent = "RESUME";
    UI.currentWord.classList.add('blink');
    clearTimeout(State.wordTimer);
  } else {
    State.isPaused = false;
    UI.startText.textContent = "PAUSE";
    UI.currentWord.classList.remove('blink');
    displayNextWord();
  }
}

function resetTraining() {
  State.isTraining = false;
  State.isPaused = false;
  State.timeLeft = 60;
  State.wordCount = 0;
  State.currentWordIndex = 0;
  UI.currentWord.textContent = "READY";
  UI.nextGhost.textContent = "...";
  UI.progressFill.style.width = "0%";
  UI.startText.textContent = "ACTIVATE";
  UI.currentWord.classList.remove('blink');
  clearInterval(State.timer);
  clearTimeout(State.wordTimer);
}

function displayNextWord() {
  if (!State.isTraining || State.isPaused) return;
  
  // 1. Get words
  const word = State.words[State.currentWordIndex];
  const nextWord = State.words[State.currentWordIndex + 1] || "END OF DATA";
  
  // 2. Display logic
  UI.currentWord.textContent = word;
  UI.nextGhost.textContent = nextWord; // Show ghost text
  
  State.currentWordIndex++;
  if (State.currentWordIndex >= State.words.length) {
    State.currentWordIndex = 0; // Loop story if finished
  }
  
  State.wordCount++;
  UI.wordCount.textContent = State.wordCount;
  
  // 3. DYNAMIC PACING LOGIC (The "New Game Logic")
  // Base calculation: 60000ms / WPM = ms per word
  let baseDelay = 60000 / State.targetWPM;
  
  // Modifier A: Long words take longer
  if (word.length > 8) baseDelay *= 1.3;
  else if (word.length > 12) baseDelay *= 1.5;
  
  // Modifier B: Punctuation (Comma/Period) pauses
  const lastChar = word.slice(-1);
  if (lastChar === '.' || lastChar === '!' || lastChar === '?') {
    baseDelay *= 1.8; // Strong pause
  } else if (lastChar === ',' || lastChar === ';' || lastChar === ':') {
    baseDelay *= 1.4; // Weak pause
  }
  
  updateWPM();
  State.wordTimer = setTimeout(displayNextWord, baseDelay);
}

function updateCountdown() {
  if (!State.isTraining || State.isPaused) return;
  State.timeLeft--;
  UI.timeLeft.textContent = State.timeLeft;
  
  const progress = ((60 - State.timeLeft) / 60) * 100;
  UI.progressFill.style.width = `${progress}%`;
  UI.progressText.textContent = `${Math.round(progress)}%`;
  
  // Dynamic Speed Up (Gameification)
  // Every 15 seconds, increase target WPM slightly
  if (State.timeLeft === 45 || State.timeLeft === 30 || State.timeLeft === 15) {
     State.targetWPM += 20;
     UI.wpm.textContent = State.targetWPM;
     UI.wpm.style.color = 'var(--vile-red)'; // Flash red
     setTimeout(() => UI.wpm.style.color = 'var(--cyber-blue)', 500);
  }

  if (State.timeLeft <= 0) endTraining();
}

function updateWPM() {
  const elapsedTime = 60 - State.timeLeft;
  if (elapsedTime > 0) {
    State.sessionWPM = Math.floor((State.wordCount / elapsedTime) * 60);
  }
}

function endTraining() {
  State.isTraining = false;
  clearInterval(State.timer);
  clearTimeout(State.wordTimer);
  
  UI.finalWPM.textContent = State.sessionWPM;
  UI.finalWords.textContent = State.wordCount;
  UI.finalLevel.textContent = State.maxLevel;
  
  let msg = "DATA UPLOAD COMPLETE";
  if (State.sessionWPM > 450) msg = "CYBERNETIC GOD MODE";
  else if (State.sessionWPM > 350) msg = "NEURAL LINK ESTABLISHED";
  
  UI.modalMsg.textContent = msg;
  UI.modal.classList.remove('hidden');
  document.querySelector('.modal-stats').style.display = 'flex';
}

function restartTraining() {
  UI.modal.classList.add('hidden');
  startTraining();
}

function toMenu() {
  State.isTraining = false;
  clearInterval(State.timer);
  clearTimeout(State.wordTimer);
  UI.game.classList.add('hidden');
  UI.modal.classList.add('hidden');
  UI.menu.classList.remove('hidden');
}

// Set default
setSpeed('normal');

// Keyboard handling
document.addEventListener('keydown', function(e) {
  if (e.code === 'Space') {
    e.preventDefault();
    if (!UI.menu.classList.contains('hidden')) startTraining();
    else if (!UI.game.classList.contains('hidden')) toggleTraining();
  }
  if (e.code === 'Escape' && !UI.game.classList.contains('hidden')) toMenu();
});
</script>
</body>
</html>
